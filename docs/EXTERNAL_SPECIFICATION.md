# 24時間オンラインコワーキングスペース 外部仕様書

## 1. システム概要

### 1.1 概要
24時間365日稼働するTwitch配信型のオンラインコワーキングスペース。視聴者はチャットコマンドを通じて配信に参加し、作業時間の記録、仮想ポイントの獲得、ランキング競争などを楽しむことができる。

### 1.2 主要機能
- **作業セッション管理**: チャットコマンドで作業開始/終了を管理
- **作業時間トラッキング**: デイリー・累計の作業時間を記録
- **仮想ポイントシステム (Raziiipo)**: 作業時間に応じてポイント付与、スロット等で使用可能
- **ランキング機能**: 作業時間・ポイントの順位を表示
- **アクション機能**: アイコンにアニメーション効果を適用
- **専用アイコン**: サブスクライバーティア別のアイコン表示

### 1.3 対象プラットフォーム
- Twitch（メインプラットフォーム）

### 1.4 参考事例
- Rusty's Retirement（農業放置ゲーム、Twitchチャット連動）
- FLY ONLINE（自作MMORPG、Twitchチャット連動）

---

## 2. ユーザー階層

### 2.1 ティア分類
| ティア | 説明 | 特典 |
|--------|------|------|
| フォロワー | Twitchフォロワー | 基本機能のみ |
| Tier 1 | サブスクライバー Tier 1 | 特殊アクション利用可能 |
| Tier 2 | サブスクライバー Tier 2 | 特殊アクション利用可能 |
| Tier 3 | サブスクライバー Tier 3 | 特殊アクション利用可能 |
| 専用アイコン | 特定ユーザー | 専用アイコン表示 |

### 2.2 Raziiipo付与レート（作業時間1時間あたり）
| ティア | 付与ポイント |
|--------|--------------|
| フォロワー | 10p |
| Tier 1 | 50p |
| Tier 2 | 100p |
| Tier 3 | 150p |

---

## 3. コマンド仕様

> **凡例**:
> - ✅ **実装済み**: 現在利用可能
> - 🔄 **計画中**: 仕様策定済み、実装予定

### 3.1 入退室コマンド

#### `/in` ✅
**実装状況**: 実装済み
**説明**: 作業を開始する（作業名なし）
**デフォルト作業時間**: 120分
**BOT応答**: `"{ユーザー名}さんが入室しました"`

#### `/in <作業名>` ✅
**実装状況**: 実装済み
**説明**: 作業名を指定して作業を開始
**パラメータ**:
- `<作業名>`: 任意の文字列（最大5文字表示、6文字目以降は「…」で省略）

**例**: `/in 仕事`
**BOT応答**: `"{ユーザー名}さんが{作業名}を開始しました"`

#### `/in min <分数>` 🔄
**実装状況**: 計画中
**説明**: 作業時間を指定して入室
**パラメータ**:
- `<分数>`: 1〜360分の範囲

**例**: `/in min 30`
**BOT応答**: `"{ユーザー名}さんが{作業名}を{分数}分開始しました"`

#### `/change <作業名>` ✅
**実装状況**: 実装済み
**説明**: 作業名を変更
**パラメータ**:
- `<作業名>`: 任意の文字列

**例**: `/change 勉強`
**BOT応答**: `"{ユーザー名}さんが{作業名}を開始しました"`

#### `/more <分数>` ✅
**実装状況**: 実装済み
**説明**: 作業時間を延長
**パラメータ**:
- `<分数>`: 1〜360分の範囲

**例**: `/more 120`
**BOT応答**: `"{ユーザー名}さんが{分数}分作業を延長しました"`

#### `/out` ✅
**実装状況**: 実装済み
**説明**: 退出
**BOT応答**: `"{ユーザー名}さんが退出しました"`

---

### 3.2 情報表示コマンド

#### `/info` ✅
**実装状況**: 実装済み
**説明**: 自分の退出までの時間、今日の累計作業時間、累計作業時間を表示
**BOT応答**: `"{ユーザー名}さん→退出まで:{分数}分/今日の累計作業時間:{分数}分/累計作業時間:{分数}分"`

#### `/cheer @<ユーザー名>` 🔄
**実装状況**: 計画中
**説明**: 入室している他のユーザーを応援
**パラメータ**:
- `@<ユーザー名>`: 応援対象のユーザー

**例**: `/cheer @raziii03`
**BOT応答**: `"{ユーザー名}さんが{対象ユーザー名}さんを応援しています"`
**画面表示**: アプリ内コメントに「{ユーザー名}さんを応援中！」と表示

---

### 3.3 アクションコマンド

#### `/sleep [秒数]` 🔄
**実装状況**: 計画中（[Issue #12](https://github.com/yamada-ai/workspace-backend/issues/12)）
**説明**: アイコンが居眠りする
**権限**: 全ユーザー
**パラメータ**:
- `[秒数]`: 1〜60秒の範囲（省略時: 10秒）

**例**: `/sleep 60`
**BOT応答**: `"{ユーザー名}さんが居眠りをしています"`
**アニメーション**: 指定秒数間、居眠りアニメーション表示

#### `/dance [秒数]` 🔄
**実装状況**: 計画中（[Issue #12](https://github.com/yamada-ai/workspace-backend/issues/12)）
**説明**: アイコンが踊る
**権限**: Tier 1, 2, 3のみ
**パラメータ**:
- `[秒数]`: 1〜60秒の範囲（省略時: 10秒）

**例**: `/dance 60`
**BOT応答**: `"{ユーザー名}さんがダンスをしています"`
**アニメーション**: 指定秒数間、ダンスアニメーション表示

#### `/happy [秒数]` 🔄
**実装状況**: 計画中（[Issue #12](https://github.com/yamada-ai/workspace-backend/issues/12)）
**説明**: アイコンが喜ぶ
**権限**: Tier 1, 2, 3のみ
**パラメータ**:
- `[秒数]`: 1〜60秒の範囲（省略時: 10秒）

**例**: `/happy 60`
**BOT応答**: `"{ユーザー名}さんが喜んでいます"`
**アニメーション**: 指定秒数間、喜びアニメーション表示

---

### 3.4 ポイント消費コマンド

#### `/eat 10` 🔄
**実装状況**: 計画中
**説明**: カップラーメンを食べる
**消費ポイント**: Raziiipo 10pt
**BOT応答**: `"{ユーザー名}さんがカップラーメンを引き換えました"`
**アニメーション**: カップラーメンを食べるアニメーション表示

#### `/eat 100` 🔄
**実装状況**: 計画中
**説明**: 天丼を食べる
**消費ポイント**: Raziiipo 100pt
**BOT応答**: `"{ユーザー名}さんが天丼を引き換えました"`
**アニメーション**: 天丼を食べるアニメーション表示

#### `/eat 1000` 🔄
**実装状況**: 計画中
**説明**: ステーキを食べる
**消費ポイント**: Raziiipo 1000pt
**BOT応答**: `"{ユーザー名}さんがステーキを引き換えました"`
**アニメーション**: ステーキを食べるアニメーション表示

#### `/slot <ポイント>` 🔄
**実装状況**: 計画中
**説明**: スロットを回す
**パラメータ**:
- `<ポイント>`: 賭けるRaziiipo

**例**: `/slot 20`
**BOT応答**:
```
{ユーザー名}：賭けポイント{ポイント}
結果：x{倍率} 合計：{獲得ポイント} 総合Raziiipo：{合計ポイント}
```

**スロット倍率**:
| 倍率 | 確率 |
|------|------|
| x0 | 50% |
| x1 | 30% |
| x2 | 15% |
| x4 | 4% |
| x10 | 0.98% |
| x100 | 0.02% |

**特殊演出**: x100当選時は特別なアニメーション表示

---

### 3.5 管理コマンド

#### `/icon_creation 1000000` 🔄
**実装状況**: 計画中
**説明**: 専用アイコン作成依頼
**消費ポイント**: Raziiipo 1,000,000pt
**BOT応答**: `"{ユーザー名}さんが専用アイコン作成を依頼しました！"`

---

### 3.6 エラー応答

| エラー条件 | BOT応答 |
|-----------|---------|
| 入室していない状態でコマンド入力 | `"入室していません"` |
| 範囲外の指定 | `"指定が間違っています"` |
| 権限のないコマンド入力 | `"コマンドを実行する権限がありません"` |
| 存在しないコマンド入力 | `"存在しないコマンドです"` |

---

## 4. 仮想ポイントシステム (Raziiipo)

### 4.1 ポイント獲得方法

#### チャンネルポイント交換（Twitch限定）
- 交換レート: チャンネルポイント100pt → Raziiipo 10pt

#### 作業時間報酬
作業時間1時間ごとに自動付与（前述の「2.2 Raziiipo付与レート」参照）

### 4.2 ポイント使用用途
- `/eat` コマンド: 食べ物アニメーション表示
- `/slot` コマンド: スロットゲーム
- `/icon_creation` コマンド: 専用アイコン作成依頼

---

## 5. ランキングシステム

### 5.1 ランキング種類

#### 作業時間デイリーランキング
- 集計期間: 当日0:00〜23:59の作業時間
- 表示: 上位3名
- 表示形式: `1位 {ユーザー名} {HH:MM:SS}`

#### 作業時間累計ランキング
- 集計期間: 全期間の累計作業時間
- 表示: 上位3名
- 表示形式: `1位 {ユーザー名} {DD:HH:MM:SS}`

#### 仮想ポイントランキング
- 集計対象: 現在の保有Raziiipo
- 表示: 上位3名
- 表示形式: `1位 {ユーザー名} {ポイント数}`

---

## 6. 画面表示仕様

### 6.1 ユーザー表示要素

#### アイコン
- フォロワー、Tier 1-3別のアイコンセット
- 各グループからランダムで選択
- 専用アイコンユーザーは専用アイコン表示

#### ユーザー名
- 最大5文字表示
- 6文字目以降は「…」で省略
- 文字サイズ自動調整

#### 作業名
- 最大5文字表示
- 6文字目以降は「…」で省略
- 文字サイズ自動調整

#### コメント
- 最大10文字表示
- 11文字目以降は「…」で省略
- 文字サイズ自動調整
- 表示時間: 5秒
- 5秒以内に新しいコメントがあれば上書きして再度5秒表示

### 6.2 アニメーション仕様

#### アイコンアニメーション種類
| アクション | ファイル命名規則 | 用途 |
|-----------|-----------------|------|
| 通常 | `{icon_id}_nomal.jpg` | /in等、アクション時以外 |
| 居眠り | `{icon_id}_sleep.jpg` | /sleep コマンド |
| ダンス | `{icon_id}_dance.jpg` | /dance コマンド |
| 喜び | `{icon_id}_happy.jpg` | /happy コマンド |
| 食事（カップ麺） | `{icon_id}_eat_10.jpg` | /eat 10 コマンド |
| 食事（天丼） | `{icon_id}_eat_100.jpg` | /eat 100 コマンド |
| 食事（ステーキ） | `{icon_id}_eat_1000.jpg` | /eat 1000 コマンド |
| スロット大当たり | `{icon_id}_slot.jpg` | /slot x100当選時 |

---

## 7. 配信画面構成

### 7.1 OBS配信画面レイアウト要素
- **メインエリア**: 背景画像
- **コメント表示エリア**: 最新コメント表示（Bot除外）
- **ランキング表示エリア**:
  - デイリー作業時間ランキング
  - 累計作業時間ランキング
  - Raziiipoランキング
- **参加状況表示**: 作業中人数
- **スケジュール/お知らせ表示**
- **時刻表示**
- **天気・ニュース表示**（オプション）

---

## 8. 禁止ワード機能

### 8.1 機能概要
- 管理者が設定した禁止ワードをチャットで使用したユーザーを自動ブロック
- 設定はサーバー側で管理

---

## 9. システム要件

### 9.1 配信環境
- プラットフォーム: Twitch
- 配信ツール: OBS Studio
- 配信時間: 24時間365日（常時）

### 9.2 想定サーバースペック
- CPU: Intel Core i7 7700 (Kaby Lake) 以上
- メモリ: 16GB以上
- OS: Windows 10 Home 64bit / Linux

---

## 10. 参考資料

### 10.1 類似システム
- Kukoro: Stream chat games（Steamゲーム）
- Rusty's Retirement（農業放置ゲーム）
- FLY ONLINE（自作MMORPG）
- LurkBait Twitch Fishing（釣りゲーム）
- Vampire Survivors（イベント選択型）
- King of The Castle（視聴者参加型政治シミュレーション）

### 10.2 技術参考
- [youtube配信型オンライン自習室を作った](https://zenn.dev/soraride/articles/a546dbfc4bb6ee)
- [UnityでTwitchチャットと連携するシンプルなゲームを作った](https://qiita.com/mojomojopon/items/c74b3027e1302d489f77)

---

## 11. 将来的な拡張案

### 11.1 検討中の機能
- オーバーレイ部分にランダムで猫を走らせる演出
- 流れ星等のランダム演出
- 特定のSE追加（スロットx100当選時等）
- ポモドーロタイマー統合

### 11.2 廃止された機能
- 座席/椅子システム
- YouTube連携
- Discord連携
